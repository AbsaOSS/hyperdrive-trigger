<!--
  ~ Copyright 2018 ABSA Group Limited
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div class="content-area">
  <clr-datagrid (clrDgRefresh)="onClarityDgRefresh($event)" [clrDgLoading]="loading">

    <clr-dg-action-bar>
      <div class="btn-group">
        <button type="button" class="btn btn-sm btn-secondary"><clr-icon shape="trash"></clr-icon> Clear filters </button>
        <button type="button" class="btn btn-sm btn-secondary"><clr-icon shape="trash"></clr-icon> Clear sort </button>
        <button type="button" class="btn btn-sm btn-secondary"><clr-icon shape="refresh"></clr-icon> Refresh </button>
      </div>
    </clr-dg-action-bar>

    <clr-dg-column [clrDgField]="dagRunColumns.WORKFLOW_NAME" [clrFilterValue]>
      <ng-container *clrDgHideableColumn="{hidden: false}">Workflow name</ng-container>
    </clr-dg-column>
    <clr-dg-column [clrDgField]="dagRunColumns.PROJECT_NAME">
      <ng-container *clrDgHideableColumn="{hidden: false}">Project name</ng-container>
    </clr-dg-column>
    <clr-dg-column [clrDgField]="dagRunColumns.JOB_COUNT">
      <ng-container *clrDgHideableColumn="{hidden: false}">Job count</ng-container>
    </clr-dg-column>
    <clr-dg-column [clrDgField]="dagRunColumns.STARTED">
      <ng-container *clrDgHideableColumn="{hidden: false}">Started</ng-container>
    </clr-dg-column>
    <clr-dg-column [clrDgField]="dagRunColumns.FINISHED">
      <ng-container *clrDgHideableColumn="{hidden: false}">Finished</ng-container>
    </clr-dg-column>
    <clr-dg-column [clrDgField]="dagRunColumns.STATUS">
      <ng-container *clrDgHideableColumn="{hidden: false}">Status</ng-container>
    </clr-dg-column>
    <clr-dg-placeholder>We couldn't find any dag runs!</clr-dg-placeholder>

    <clr-dg-row *ngFor="let dagRun of dagRuns" [clrDgItem]="dagRun">
      <clr-dg-cell>{{dagRun.workflowName}}</clr-dg-cell>
      <clr-dg-cell>{{dagRun.projectName}}</clr-dg-cell>
      <clr-dg-cell>{{dagRun.jobCount}}</clr-dg-cell>
      <clr-dg-cell>{{dagRun.started | date:'medium'}}</clr-dg-cell>
      <clr-dg-cell>{{dagRun.finished | date:'medium'}}</clr-dg-cell>
      <clr-dg-cell [ngSwitch]="dagRun.status">
        <clr-icon *ngSwitchCase="dagInstanceStatuses.IN_QUEUE" shape="clock" class="is-solid" style="color: grey"></clr-icon>
        <clr-icon *ngSwitchCase="dagInstanceStatuses.RUNNING" shape="play" class="is-solid" style="color: blue"></clr-icon>
        <clr-icon *ngSwitchCase="dagInstanceStatuses.SUCCEEDED" shape="success-standard" class="is-solid" style="color: green"></clr-icon>
        <clr-icon *ngSwitchCase="dagInstanceStatuses.FAILED" shape="error-standard" class="is-solid" style="color: red"></clr-icon>
        <clr-icon *ngSwitchDefault shape="help" class="is-solid" style="color: darkgoldenrod"></clr-icon>
        {{dagRun.status}}
      </clr-dg-cell>
    </clr-dg-row>

    <clr-dg-detail *clrIfDetail="let detail">
      <clr-dg-detail-header>{{detail.workflowName}} ({{detail.projectName}}) - {{detail.started | date:'medium'}} - {{detail.finished | date:'medium'}}</clr-dg-detail-header>
      <clr-dg-detail-body>
        <app-run-detail [dagRunId]="detail.id"></app-run-detail>
      </clr-dg-detail-body>
    </clr-dg-detail>

    <clr-dg-footer>
      <clr-dg-pagination #pagination [clrDgPageSize]="50" [(clrDgPage)]="page"
                         [clrDgTotalItems]="total"></clr-dg-pagination>
      <clr-dg-page-size [clrPageSizeOptions]="[50,100,150,200,250]">Dag runs per page</clr-dg-page-size>
      {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
      of {{total}} dag runs
    </clr-dg-footer>
  </clr-datagrid>
</div>
